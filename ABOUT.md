# Концепция структуры проекта
Основная концепция заключается в том, что каждая сущность должна лежать там где ей и место. 
Даже если это одна какая-то сущность на весь проект, она все равно должна лежать в отведенном для нее месте, 
не рядом с main.py, все должно соответствовать бизнес-логике.

Итак, в данном проекте я выделил основные или часто встречающиеся сущности, которые можно встретить почти в каждом проекте.
#### 1) `/app`
Это корень нашего приложения. Здесь приемлемо хранить `main.py` и 
различные настройки для приложения. В данном случае так и есть, 
можно увидеть `main.py` и `config.py`.
    
Больше никаких других `.py` файлов здесь быть не должно. Более того, бывают такие случаи, 
когда нужно держать в приложении несколько `config.py` файлов, тогда в пакете остается 
только `main.py` а конфиги отправляются в отдельный пакет.
Так же в данном пакете должны лежать пакеты `api` и `tests`. По поводу названия пакета `api` 
можно еще поспорить, так как это пакет, в котором по сути лежит вся логика нашего приложения. 
Но так как мы, все таки, пишем в большинстве своем сервисы, в которых могут быть ручки 
то пусть пожалуй этот пакет так и называется `api`.
  
#### 2) `/app/api`
Тут лежит основная логика нашего приложения, в которой я выделил основные сущности и разнес их по пакетам:

- _crud_ - Это сущность, в которой происходит всё взаимодействие с БД с 
помощью запросов SQLAlchemy, кроме подключения. Если помимо самих crud вы 
используете чистые SQL запросы, то тут им самое место. Но если их много и их 
как то логически можно структурировать, то следует создать пакет 
`sql` и распихать по `.py` файлам.

- _db_ - Здесь инициализируется подключение к БД и задается базовый класс для формирования моделей. 
Больше никакого наполнения данный пакет не предполагает.

- _models_ - Модели. КАЖДАЯ МОДЕЛЬ ДОЛЖНА ЛЕЖАТЬ В СВОЕМ `.py` ФАЙЛЕ!!! 
Недопустимо все модели держать в одном `.py` файле. Каждую модель следует импортировать в `__init__.py`, 
чтобы alembic все их увидел если вам понадобятся миграции.

- _schemas_ - Схемы. Тут уже не как с моделями. Не нужно для каждой схемы делать отдельный файл, 
но если это какая-то отдельная схема, которую нельзя положить к другим схемам и она ни с какой другой 
схемой не в связке, то нужно сделать ей отдельный `.py` файл. 
  
- _utils_ - Пакет, для различных модулей вашей программы, у которых не удалось
определить конкретную сущность, или которые нельзя никуда инкапсулировать, или которые по 
своей незначительности не хотелось бы видеть на уровне со всеми остальными пакетами. Сюда я, например, 
помещаю пакет `enum` со всеми enum классами или вспомогательные функции, которые в основной логике не участвуют, 
но они важны в каких то отдельных частях проекта. Сюда я поместил `health_check.py`, так как эта фича 
не является каким то основным куском проекта, но и при этом не совсем было бы правильно класть ее рядом 
с контроллерами, так как иначе она там смотрелась бы как какой-то нереально важный компонент, 
который помимо кубера еще кто-то дергает.

- _v*_ - Пакет, в котором содержится * версия логики нашего проекта. Сейчас это `v1`, 
если когда-нибудь понадобится сделать еще одну версию, то создается рядом пакет `v2` и в нем пишется логика. 
Тут просто работает концепция версионности.

Сюда же можно добавить пакет для воркеров `workers`, если они вам нужны. 
В принципе если ваша логика не заключается в том, чтобы реализовывать API, 
то допускается создать тут какой-то пакет с названием той сущности, которую 
вы реализуете и всю оставшуюся логику в своем пакете реализуете.

#### 3) `/app/api/v*`
Тут я выделяю следующие сущности:
- _controllers_ - Тут лежат все API методы которые вы реализуете. Их тоже следует разбивать 
на различные файлы, следуя бизнес-логике. Если это ручки исключительно для авторизации, 
то пусть они лежат в отдельном контроллере. Если это ручки, которые позволяют как то взаимодействовать 
с объектом базы, то их тоже стоит логически в один `.py` файл объединить. 
  
Чтобы подключить контроллер к префиксу, `/api/v*` следует посмотреть в файл `__init__.py`, 
который находится в `/app/api/v*`.
  
- _services_ - Тут лежит вся логика их ручек контроллеров. Идеальный вариант будет, когда в 
контроллере дергался метод из сервиса и результат работы сервиса просто возвращается контроллером. 
Важно: у каждого контроллера свой сервис. Если в контроллере найдется метод который дергает метод 
не из своего сервиса, то нужно задуматься и что-то реорганизовать.
  
- _tasks_ - Сюда я обычно кладу какие-то фоновые задачи, которые делает приложение 
после того как ручка уже отдала ответ.

#### 4) `/app/tests`
В корне должен быть `conftest.py` и допускаю чтобы присутствовал файл с константами для тестов. 
Все остальные вспомогательные вещи должны лежать в `/app/tests/utils`. При этом опять же важно не забывать о 
классификации того что ты пишешь на сущности. Я в `utils` создаю файл `mocks.py`, в котором у меня только моки. 
Нужны фикстуры, пожалуйста, создай файл для фикстур. Не нужно все в кучу сваливать. 
    
_ВАЖНО!!_
Пакет `/app/tests/api` _ДОЛЖЕН СТРУКТУРНО ПОВТОРЯТЬ_ `/app/api`. 
Нельзя складывать тесты в один файл! Если вы тестируете контроллер, 
то этот тест должен лежать в `/app/tests/api/v*/controllers` и нигде иначе!

### P.S
Так же я считаю важно не только выделить какую то сущность и вынести ее в отдельный пакет, 
но и постараться придумывать такие названия, чтобы в конце названия 
отражалась сущность объекта. Например: 
SomeSchema, SomeHandler, SomeModel, SomeController, SomeService и т.д.

### P.P.S.
Помните, вы не последний, кто, возможно, поработает в вашем репозитории. 
Чтобы и вам и человеку, который будет работать с вашим кодом, было проще 
ориентироваться в проекте, была сформирована именно такая структура.

